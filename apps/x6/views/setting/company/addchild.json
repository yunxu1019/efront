{"controller":" [\"$scope\", \"alert\", \"$timeout\", \"api\", \"storage\", \"cache\", function ($scope,alert,$timeout,api,storage,cache){\r\n\tvar num=$scope.data.num;\r\n\t$scope.companys=new Array();\r\n\t$scope.areas=new Object();\r\n\tfor(var i=0;i<num;i++){\r\n\t\t$scope.companys.push({\r\n\t\t\tid:-1,\r\n\t\t\tcj:\"2\",\r\n\t\t\tlx:\"2\",\r\n\t\t\tpbm:$scope.data.pbm,\r\n\t\t\tname:\"\",\r\n\t\t\tcountry:\"\u4e2d\u56fd\",\r\n\t\t\tprovince:\"\",\r\n\t\t\tcity:\"\",\r\n\t\t\ttown:\"\",\r\n\t\t\tdz:\"\",\r\n\t\t\tfzrdm:\"\",\r\n\t\t\trequire:false\r\n\t\t})\r\n\t}\r\n\t$scope.isshow=false;\r\n\t$scope.fzrlist=cache.userlist;\r\n\t//\u83b7\u53d6\u8eab\u4efd\r\n\tapi(\"/x6/getProvinceList.do\",{})\r\n\t\t\t.onsuccess(function(data){\r\n\t\t\t\tfor(var i=0;i<data.list.length;i++){\r\n\t\t\t\t\tdata.list[i]=data.list[i].province;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$scope.provs=data.list;\r\n\t\t\t})\r\n\t//\u83b7\u53d6\u57ce\u5e02\r\n\t$scope.ckey=[];\r\n\t$scope.citys={};\r\n\t$scope.getCityList=function(obj,index){\r\n\t\t$scope.companys[index].city=\"\";\r\n\t\t$scope.companys[index].town=\"\";\r\n\t\tvar param={\r\n\t\t\tprovince:obj\r\n\t\t}\r\n\t\t$scope.ckey[index]=obj;\r\n\t\tif(!$scope.citys[obj]){\r\n\t\t\tapi('/x6/getCityList.do',param)\r\n\t\t\t.onsuccess(function(data){\r\n\t\t\t\tfor(var i=0;i<data.list.length;i++){\r\n\t\t\t\t\tdata.list[i]=data.list[i].city;\r\n\t\t\t\t}\r\n\t\t\t\t$scope.citys[obj]=data.list;\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t//\u83b7\u53d6\u53bf\u533a\r\n\t$scope.akey=[];\r\n\t$scope.areas={};\r\n\t$scope.getTownList=function(obj,index){\r\n\t\t$scope.companys[index].town=\"\";\r\n\t\tvar param={\r\n\t\t\tcity:obj\r\n\t\t}\r\n\t\t//console.log(obj)\r\n\t\t$scope.akey[index]=obj;\r\n\t\tif(!$scope.areas[obj]){\r\n\t\t\tapi('/x6/getTownList.do',param)\r\n\t\t\t.onsuccess(function(data){\r\n\t\t\t\tfor(var i=0;i<data.list.length;i++){\r\n\t\t\t\t\tdata.list[i]=data.list[i].town;\r\n\t\t\t\t}\r\n\t\t\t\t$scope.areas[obj]=data.list;\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t//\u6dfb\u52a0\u8d1f\u8d23\u4eba\r\n\t$scope.addPerson=function(){\r\n\t\tconsole.log(5455)\r\n\t}\r\n\t\r\n\t$scope.$ViewOptions={\r\n\t\t\"\u786e\u8ba4\":function(){\r\n\t\t\t$scope.isshow=true;\r\n\t\t\t//\u9a8c\u8bc1\u8f93\u5165\u5408\u6cd5\u6027\r\n\t\t\tvar required=[\r\n\t\t\t\t{\r\n\t\t\t\t\tname:\"name\",\r\n\t\t\t\t\tmsg:\"\u516c\u53f8\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname:\"province\",\r\n\t\t\t\t\tmsg:\"\u7701\u4efd\u4e0d\u80fd\u4e3a\u7a7a\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname:\"city\",\r\n\t\t\t\t\tmsg:\"\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname:\"town\",\r\n\t\t\t\t\tmsg:\"\u53bf/\u533a\u4e0d\u80fd\u4e3a\u7a7a\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname:\"dz\",\r\n\t\t\t\t\tmsg:\"\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\"\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\tvar temp=verify(required,$scope.companys);\r\n\t\t\tif(temp){\r\n\t\t\t\tfor(var i=0;i<$scope.companys.length;i++){\r\n\t\t\t\t\t$scope.companys[i].fzrdm=$scope.companys[i].fzrdm.id;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tapi('/x6/bathSaveXtGsxx.do',{rows:$scope.companys}).onsuccess(function(data){\r\n\t\t\t\t\tif(data.result==\"ok\"){\r\n\t\t\t\t\t\talert.success(\"\u65b0\u589e\u6210\u529f\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\talert.warn(data.message);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t//console.log($scope.companys)\r\n\t\t},\r\n        \"\u5173\u95ed\":function(){\r\n                    \r\n        }\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tfunction getElement(row,col){\r\n\t\tvar target=document.getElementsByClassName(\"container-items\")[row].childNodes;\r\n\t\tvar _left=target[2*col+3].getBoundingClientRect().left;\r\n\t\tvar _top=target[2*col+3].getBoundingClientRect().top;\r\n\t\treturn {\r\n\t\t\tleft:_left,\r\n\t\t\ttop:_top\r\n\t\t}\r\n\t}\r\n\tfunction verify(required,obj){\r\n\t\tfor(var i = 0; i < obj.length; i++) {\r\n\t\t\tfor(var j = 0; j < required.length; j++) {\r\n\t\t\t\t//\u5f53\u68c0\u6d4b\u5230\u6709\u7a7a\u503c\u7684\u65f6\u5019\r\n\t\t\t\tif(!obj[i][required[j].name]) {\r\n\t\t\t\t\t//console.log(333)\r\n\t\t\t\t\tobj[i].require = false;\r\n\t\t\t\t\tvar place = getElement(i, j);\r\n\t\t\t\t\talert.require(required[j].msg, place.top, place.left);\r\n\t\t\t\t\t//break;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[i].require = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}]","template":"<style>.setting-company-addchild .container {\n  width: 95%;\n  height: 100%;\n  margin: 0 auto;\n}\n.setting-company-addchild .container > .container-head {\n  width: 760px;\n  height: 38px;\n  margin-top: 5px;\n  background: #f8f9fd;\n  border-bottom: 1px solid #dfdfdf ;\n  border-top: 1px solid #dfdfdf ;\n  overflow: hidden;\n}\n.setting-company-addchild .container > .container-head > span {\n  display: block;\n  float: left;\n  line-height: 38px;\n  width: 20%;\n}\n.setting-company-addchild .container > .container-head > span:first-child {\n  margin-left: 5%;\n}\n.setting-company-addchild .container > .container-head > span:nth-child(2) {\n  width: 55%;\n}\n.setting-company-addchild .container > .container-items {\n  width: 100%;\n  height: 30px;\n  margin: 5px 0;\n  position: relative;\n}\n.setting-company-addchild .container > .container-items > span {\n  height: 30px;\n  display: inline-block;\n  width: 5%;\n  line-height: 30px;\n  text-align: center;\n  float: left;\n}\n.setting-company-addchild .container > .container-items > span > i.pass {\n  color: #42bb82;\n}\n.setting-company-addchild .container > .container-items > span > i.nopass {\n  color: #f67a7a;\n}\n.setting-company-addchild .container > .container-items > .text-input {\n  height: 30px;\n  padding-left: 5px;\n  border: 1px solid #dfdfdf;\n  outline: none;\n  box-sizing: border-box;\n}\n.setting-company-addchild .container > .container-items > span + .text-input {\n  margin-left: -5px;\n  width: 19%;\n}\n.setting-company-addchild .container > .container-items > .selector {\n  width: 10%;\n  height: 30px;\n  border: 1px solid #dfdfdf;\n  outline: none;\n}\n.setting-company-addchild .container > .container-items > .selector + .text-input {\n  width: 24%;\n}\n.setting-company-addchild .container > .container-items > .selector:nth-child(7) {\n  width: 17%;\n}\n</style><div class=\"container\">\r\n\t<div class=\"container-head\">\r\n\t\t<span>\u5206\u516c\u53f8\u540d\u79f0</span>\r\n\t\t<span>\u7701\u5e02&\u8be6\u7ec6\u5730\u5740</span>\r\n\t\t<span>\u8d1f\u8d23\u4eba</span>\r\n\t</div>\r\n\t<div class=\"container-items\" ng-repeat=\"item in companys track by $index\">\r\n\t\t<span>\r\n\t\t\t<i ng-class=\"{true:'iconfont icon-gouhao pass',false:'iconfont icon-gantanhao2 nopass'}[item.require]\" ng-show=\"isshow\"></i>\r\n\t\t</span>\r\n\t\t<text-input placeholder=\"\u8bf7\u8f93\u5165\u540d\u79f0\" ng-model=\"item.name\"></text-input>\r\n\t\t<selector ng-model='item.province' source='provs'  ng-change=\"getCityList(item.province,$index)\"></selector>\r\n\t\t<selector ng-model='item.city' source=\"citys[ckey[$index]]\"  ng-change=\"getTownList(item.city,$index)\"></selector>\r\n\t\t<selector ng-model='item.town' source='areas[akey[$index]]' ></selector>\r\n\t\t<text-input placeholder=\"\u8bf7\u8f93\u5165\u8be6\u7ec6\u5730\u5740\" ng-model=\"item.dz\"></text-input>\r\n\t\t<selector ng-model='item.fzrdm' source='fzrlist' field='name' input edit=\"addPerson\"></selector>\r\n\t</div>\r\n</div>"}