{"controller":" [\"$scope\", \"cache\", \"api\", \"alert\", \"popup\", \"hashMap\", function ($scope, cache, api, alert, popup, hashMap) {\n    //\u52a0\u8f7d\u516c\u53f8\u5217\u8868\n    var update = function (gs) {\n        api(\"/x6/getXtGsList.do\", {}).success(function (result) {\n            var mp = hashMap();\n            var list = result.gsList || [];\n            list.forEach(function (gs) {\n                mp(gs.id, gs);\n            });\n            gslist.forEach(function (gs) {\n                var g = mp(gs.id);\n                if (g) {\n                    angular.extend(gs, g);\n                    mp(gs.id, gs);\n                } else {\n                    console.log(g);\n                }\n            });\n            list = mp.values();\n            $scope.zgs = list[0];\n            gslist.splice(0);\n            gslist.push.apply(gslist, list.slice(1));\n            cache.refresh();\n        });\n    };\n    update();\n    $scope.init_nocompany = function () {\n        api(\"/x6/noBranchComany.do\", {\n        })(function () {\n            alert.warn(\"\u5df2\u4e3a\u60a8\u6dfb\u52a0\u4e00\u5bb6\u516c\u53f8\uff01\");\n        });\n    };\n\n    //\u5728\u52a0\u8f7d\u5b8c\u6210\u4e4b\u524d\u663e\u793a\u7f13\u5b58\u4e2d\u7684\u5217\u8868\n    var gslist = function () {\n        var list = cache.gslist;\n        console.log(list);\n        var res = {ogs: {}, mdList: []};\n        var extend = angular.extend;\n        list && list.forEach(function (gs) {\n            var bm = gs.bm;\n            var tmp = res;\n            bm.replace(/\\d{4}/g, function (match) {\n                var o = tmp.ogs[match];\n                if (!o) {\n                    o = {ogs: {}, mdList: []};\n                    tmp.ogs[match] = o;\n                    tmp.mdList.push(o);\n                }\n                tmp = o;\n                return match;\n            });\n            extend(tmp, gs);\n        });\n        return res.mdList;\n    }();\n    console.log(gslist);\n    $scope.gslist = gslist;\n\n    //\u8868\u683c\u4e2d\u7f16\u8f91\u548c\u5220\u9664\n    //$\u8868\u5f0f\u4e00\u884c\u6570\u636e\n    $scope.option_template = function () {\n        return \"<span><a ng-click=editshop($)>\u7f16\u8f91</a>&nbsp;<a ng-click=remove($,$data) ng-if=!$.removing >\u5220\u9664</a><a style='color:red' ng-click=remove($,$data) ng-if=$.removing >\u518d\u70b9\u4e00\u6b21\u5220\u9664</a></span>\";\n    }();\n    //\u8868\u683c\u4e2d\u7684\u5730\u533a\u4e00\u5217\n    $scope.zone_template = function () {\n        return \"<span ng-bind=$.province></span>&nbsp;<span ng-bind=$.city></span>&nbsp;<span ng-bind=$.town></span>\";\n    }();\n    //\u7f16\u8f91\u516c\u53f8\u6216\u95e8\u5e97\n    var relative=$scope.$ViewRelative.replace(/\\/main\\/?$/,\"\");\n    $scope.editshop = function (gs) {\n\n        if (gs.cj === 2) {\n            //\u5206\u516c\u53f8\n            return popup(relative+'/editchild', {\n                \"$ViewTitle\": \"\u7f16\u8f91\u5206\u516c\u53f8\",\n                \"$ViewOptions\": {\n                    \"\u786e\u8ba4\": function () {\n\n                    },\n                    \"\u5173\u95ed\": function () {\n\n                    }\n                },\n                data: gs\n            }, {\n                width: 400,\n                height: 350\n            }).onclose(function () {\n                update(gs);\n            });\n        }\n        popup(relative+'/editshop', {\n            \"$ViewTitle\": \"\u7f16\u8f91\u95e8\u5e97\",\n            \"$ViewOptions\": {\n                \"\u786e\u8ba4\": function () {\n\n                },\n                \"\u5173\u95ed\": function () {\n\n                }\n            },\n            data: gs,\n            gslist: gslist\n\n        }, {\n            width: 400,\n            height: 450\n        }).onclose(function () {\n            update(gs);\n        });\n    };\n\n    //\u7f16\u8f91\u4ed3\u5e93\n    $scope.editstorage = function (gs) {\n        popup(relative+'/editstorage', {\n            \"$ViewTitle\": \"\u7f16\u8f91\u603b\u516c\u53f8\u76f4\u5c5e\u4ed3\u5e93\",\n            \"$ViewOptions\": {\n                \"\u786e\u8ba4\": function () {\n\n                },\n                \"\u5173\u95ed\": function () {\n\n                }\n            },\n            data: {\n                gsdm: gs.gsdm,\n                bm: gs.bm\n            }\n        }, {\n            width: 500,\n            height: 400\n        }).onclose(function () {\n            update(gs);\n        });\n    };\n    //\u5220\u9664\n    $scope.remove = function (gs, parent) {\n        if (gs.removing) {\n            //TODO \u7b49\u5f85\u63a5\u53e3\u5b8c\u6210\n            api(\"/x6/deleteGsxx.do\", {\n                gsdm: gs.gsdm,\n                id: gs.id\n            }).success(function () {\n                for (var cx = parent.length - 1; cx >= 0; cx--) {\n                    var s = parent[cx];\n                    if (gs.gsdm === s.gsdm && gs.id === s.id) {\n                        parent.splice(cx, 1);\n                    }\n                }\n            });\n            return;\n        }\n        ;\n        gs.removing = true;\n        $timeout(function () {\n            gs.removing = false;\n        }, 1000);\n    };\n    //\u6dfb\u52a0\u5206\u516c\u53f8\n    $scope.add_fgs = function (number) {\n        if (number > 20) {\n            alert.warn(\"\u4e0d\u80fd\u5927\u4e8e20\u5bb6\uff01\");\n            return;\n        }\n        popup(relative+'/addchild', {\n            \"$ViewTitle\": \"\u6279\u91cf\u6dfb\u52a0\u5206\u516c\u53f8\",\n            \"$ViewOptions\": {\n                \"\u786e\u8ba4\": function () {\n\n                },\n                \"\u5173\u95ed\": function () {\n\n                }\n            },\n            data: {\n                num: number,\n                pbm: $scope.zgs.bm\n            }\n        }, {\n            width: 800,\n            height: 360\n        });\n        $scope.add_fgs.ing = false;\n    };\n    $scope.add_fgs.count = 0;\n    //\u6dfb\u52a0\u95e8\u5e97\n    $scope.add_md = function (fgs, count) {\n        if (count > 20) {\n            alert.warn(\"\u4e0d\u80fd\u5927\u4e8e20\u5bb6\uff01\");\n            return;\n        }\n        delete fgs.add_mding;\n        popup(relative+'/addshop', {\n            \"$ViewTitle\": \"\u6279\u91cf\u6dfb\u52a0\u95e8\u5e97\",\n            \"$ViewOptions\": {\n                \"\u786e\u8ba4\": function () {\n\n                },\n                \"\u5173\u95ed\": function () {\n\n                }\n            },\n            data: {\n                num: count,\n                pbm: fgs.bm\n            }\n        }, {\n            width: 1000,\n            height: 360\n        });\n    };\n    $scope.add_md.count = 0;\n\n    //\u6298\u53e0\u548c\u5c55\u5f00\n    var uppack = function (gs) {\n        for (var k in gslist) {\n            var g = gslist[k];\n            if (g === gs) {\n                if (g.uppack) {\n                    g.uppack = 1;\n                    -function () {\n                        var tmp = g;\n                        $timeout(function () {\n                            tmp.uppack = 0;\n                        }, 50);\n                    }();\n                } else {\n                    g.uppack = 1;\n                    -function () {\n                        var tmp = g;\n                        $timeout(function () {\n                            tmp.uppack = 44 * (gs.mdList.length+1);\n                        }, 50);\n                    }();\n                }\n                continue;\n            }\n            g.uppack = 0;\n        }\n    };\n    $scope.uppack = uppack;\n}]","template":"<style>.setting-company-main a {\n  color: #4385f5;\n  cursor: pointer;\n  border-bottom: 1px solid #4385f5;\n}\n.setting-company-main.view-content {\n  background-color: inherit;\n}\n.setting-company-main .num-option {\n  position: absolute;\n  width: 163px;\n  height: auto;\n  right: 113px;\n  top: 50px;\n  overflow: visible;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);\n  z-index: 999999999;\n  color: #2a2a2a;\n  background-color: #ffffff;\n}\n.setting-company-main .num-option:before {\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);\n  display: block;\n  content: '';\n  width: 12px;\n  height: 12px;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n  position: absolute;\n  left: 106px;\n  top: -7px;\n  background-color: inherit;\n}\n.setting-company-main .num-option > div {\n  padding: 0 14px;\n  position: relative;\n  background-color: #ffffff;\n  line-height: 26px;\n  font-size: 12px;\n  text-align: left;\n}\n.setting-company-main .num-option > div:hover {\n  background-color: #e9ecf2;\n}\n.setting-company-main .num-option > div > .number-input {\n  width: 75px;\n  height: 26px;\n  margin-right: 5px;\n  vertical-align: middle;\n}\n.setting-company-main .title {\n  color: #333333;\n  font-size: 20px;\n  height: 60px;\n  line-height: 60px;\n  text-align: right;\n}\n.setting-company-main .title > div {\n  display: inline-block;\n  text-align: right;\n}\n.setting-company-main .title > div:nth-child(1) {\n  float: left;\n}\n.setting-company-main .title > a {\n  margin: 0 20px;\n  font-size: 12px;\n}\n.setting-company-main .item {\n  margin: 1px 10px 20px 10px;\n  height: auto;\n  outline: 1px solid rgba(0, 0, 0, 0.2);\n  -webkit-transition: box-shadow 0.1s;\n  transition: box-shadow 0.1s;\n  background-color: #fff;\n  color: #333333;\n}\n.setting-company-main .item:hover {\n  box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);\n}\n.setting-company-main .item:hover:active {\n  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);\n}\n.setting-company-main .item > div:nth-child(1) {\n  -webkit-transition: background-color 0.2s;\n  transition: background-color 0.2s;\n  position: relative;\n  font-size: 14px;\n  height: 60px;\n  display: table;\n  width: 100%;\n}\n.setting-company-main .item > div:nth-child(1) > div {\n  display: table-cell;\n  vertical-align: middle;\n}\n.setting-company-main .item > div:nth-child(1) > div > i.icon {\n  vertical-align: middle;\n  margin: 0 13px;\n  width: auto;\n  background-position: left 0 center;\n  padding-left: 30px;\n  cursor: pointer;\n  position: relative;\n}\n.setting-company-main .item > div:nth-child(1) > div > i.icon > input {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  right: 0;\n  position: absolute;\n  cursor: pointer;\n}\n.setting-company-main .item > div:nth-child(1) > div > span {\n  vertical-align: middle;\n  margin: 0 13px;\n}\n.setting-company-main .item > div:nth-child(1) > .offpack {\n  display: none;\n}\n.setting-company-main .item.uppack > div:nth-child(1) {\n  border-bottom: 1px solid #ccd0d7;\n}\n.setting-company-main .item:hover {\n  outline: none;\n}\n.setting-company-main .item.uppack > div:nth-child(1),\n.setting-company-main .item:hover > div:nth-child(1) {\n  color: #fff;\n  background-color: #39c;\n}\n.setting-company-main .item.uppack > div:nth-child(1) a,\n.setting-company-main .item:hover > div:nth-child(1) a {\n  color: #fff;\n  border-color: #fff;\n}\n.setting-company-main .item.uppack > div:nth-child(1) > .onpack,\n.setting-company-main .item:hover > div:nth-child(1) > .onpack {\n  display: none;\n}\n.setting-company-main .item.uppack > div:nth-child(1) > .offpack,\n.setting-company-main .item:hover > div:nth-child(1) > .offpack {\n  display: table-cell;\n}\n.setting-company-main .item.uppack > .grid,\n.setting-company-main .item:hover > .grid {\n  /*            &.ng-enter{\n                            animation:height01 0.1s linear;\n                        }\n                        &.ng-leave{\n                            animation: height10 0.1s linner;\n                        }*/\n  -webkit-transition: height 0.1s;\n  transition: height 0.1s;\n  /*            div.grid-title,div.grid-input,div.grid-append{\n                >div{\n                    &,>div{\n                        outline: none;\n                    }\n                }\n                >div.tr:nth-child(even){\n                    >div{\n                        background-color: #f3f5fb;\n                    }\n                }\n                >div.tr:nth-child(odd):hover{\n                    >div{\n                        background-color: #ffffff;\n                    }\n                }\n            }*/\n}\n.setting-company-main .item.uppack > .grid a,\n.setting-company-main .item:hover > .grid a {\n  border-bottom: none;\n}\n/*@keyframes height01{\n    0%{\n        height: 0;\n    }\n}\n@keyframes height10{\n    100%{\n        height:0;\n    }\n}*/\n</style><div class=\"title\">\n    <div >\n        <span ng-bind=\"zgs.name\">\u82cf\u5dde\u603b\u516c\u53f8</span>\uff08\u76f4\u5c5e\u4ed3\u5e93<a ng-bind=\"zgs.ckNum\" ng-click=\"editstorage(zgs)\"></a>\uff09\n    </div>\n    <anniu ng-if=\"zgs\" ng-click=\"add_fgs.ing = !add_fgs.ing\" ng-blur=\"add_fgs.ing = add_fgs.iing || false\">\n        \u6dfb\u52a0\u5206\u516c\u53f8\n    </anniu>\n    <div ng-if='add_fgs.ing' class='num-option' ng-mousedown=\"$event.preventDefault();\" ng-style=\"{'right':zgs&&gslist.length===0?'':'0'}\">\n        <div ng-repeat=\"i in '1234567'\" ng-click=\"add_fgs(i)\">{{i}}\u5bb6\u5206\u516c\u53f8</div>\n        <div onmouseup='this.getElementsByTagName(\"input\")[0].focus()' ng-mousedown=\"add_fgs.iing = true\">\n            <number-input ng-mousedown=\"add_fgs.iing = true\" ng-blur=\"add_fgs.iing = false; add_fgs.ing = false;\" ng-model='add_fgs.count' onconfirm='add_fgs($event.target.value)'></number-input>\n            \u5bb6\u5206\u516c\u53f8\n            <anniu ng-click=\"add_fgs(add_fgs.count)\" ng-if=\"add_fgs.count-0>0&&add_fgs.count-0<=20\">\u786e\u5b9a</anniu>\n        </div>\n    </div>\n    <a ng-if=\"zgs&&gslist.length===0\" ng-company=\"init_nocompany()\" >\u6ca1\u6709\u5206\u516c\u53f8\uff1f</a>\n</div>\n\n<scroll-content ng-cloak style=\"position: absolute;left:0;right:0;top:60px;bottom:0;\">\n\n    <div class=\"item\" ng-repeat=\"gs in gslist\" ng-class=\"{'uppack':gs.uppack}\">\n        <div>\n            <div style=\"width:auto;padding:0 26px;\"><span ng-bind=\"gs.name\">\u5e38\u719f\u5206\u516c\u53f8</span>\uff08<b ng-if=\"gs.mdList\">{{gs.mdList.length}}\u5bb6\u95e8\u5e97</b>\uff0c\u76f4\u5c5e\u4ed3\u5e93<a ng-bind=\"gs.ckNum\" ng-click=\"editstorage(gs)\"></a>\uff09</div>\n            <div style=\"width:90px;\" class=\"onpack\" ng-click='editshop(gs, gslist)'><i icon=\"images/svg/edit.svg\" color=\"#eda539\">\u7f16\u8f91</i></div>\n            <div style=\"width:90px;\" class=\"onpack\" ng-click=\"gs.removing = true; remove(gs, gslist)\"><i icon=\"images/svg/remove.svg\" color=\"#f46161\">\u5220\u9664</i></div>\n            <div style=\"width:120px;\" class=\"onpack\">\n                <i icon=\"images/svg/add1.svg\" color=\"#5888f4\" ng-click=\"gs.add_mding = !gs.add_mding\">\u6dfb\u52a0\u95e8\u5e97<input ng-blur=\"gs.add_mding = gs.add_mdding || false\"/></i>\n            </div>\n            <div style=\"width:90px;\" class=\"offpack\" ng-click='editshop(gs, gslist)'><i icon=\"images/svg/edit.svg\" color=\"#fff\">\u7f16\u8f91</i></div>\n            <div style=\"width:90px;\" class=\"offpack\" ng-click=\"gs.removing = true; remove(gs, gslist)\"><i icon=\"images/svg/remove.svg\" color=\"#fff\">\u5220\u9664</i></div>\n            <div style=\"width:120px;\" class=\"offpack\">\n                <i icon=\"images/svg/add1.svg\" color=\"#fff\" ng-click=\"gs.add_mding = !gs.add_mding\">\u6dfb\u52a0\u95e8\u5e97<input ng-blur=\"gs.add_mding = gs.add_mdding || false\"/></i>\n            </div>\n            <div ng-if='gs.add_mding' class='num-option' ng-mousedown=\"$event.preventDefault();\">\n                <div ng-repeat=\"i in '1234567'\" ng-click=\"add_md(gs, i)\">{{i}}\u5bb6\u95e8\u5e97</div>\n                <div onmouseup='this.getElementsByTagName(\"input\")[0].focus()' ng-mousedown=\"gs.add_mdding = true\">\n                    <number-input ng-blur=\"gs.add_mdding = false; gs.add_mding = false\" ng-model='gs.add_count' onconfirm='add_md(gs,gs.add_count)'></number-input>\n                    \u5bb6\u95e8\u5e97\n                    <anniu ng-click=\"add_md(gs, gs.add_count)\" ng-if=\"gs.add_count-0>0&&gs.add_count-0<=20\">\u786e\u5b9a</anniu>\n                </div>\n            </div>\n            <div style=\"width:60px;\" ng-click=\"uppack(gs)\" class=\"onpack\">\n                <span ng-style=\"{'transform':'rotate('+(gs.uppack?180:0)+'deg)'}\" icon=\"images/svg/pack.svg\" color=\"#999999\" hover-color=\"#c0bebe\"></span>\n            </div>\n            <div style=\"width:60px;\" ng-click=\"uppack(gs)\" class=\"offpack\">\n                <span ng-style=\"{'transform':'rotate('+(gs.uppack?180:0)+'deg)'}\" icon=\"images/svg/pack.svg\" color=\"#ffffff\"></span>\n            </div>\n        </div>\n        <grid ng-model=\"gs.mdList\" class=noline ng-if='gs.uppack' style='width: 100%;max-height: 400px;' ng-style=\"{'height':gs.uppack + 'px'}\">\n            <div name=\"\u95e8\u5e97\u540d\u79f0\" field='name'></div>\n            <div name=\"\u533a\u57df\" colid=\"zone\" template='zone_template'>\n            </div>\n            <div name=\"\u8be6\u7ec6\u5730\u5740\" field='dz'></div>\n            <div name=\"\u8425\u4e1a\u9762\u79ef\" field='area'></div>\n            <div name=\"\u5e97\u9762\u6708\u79df\" field='rental'></div>\n            <div name=\"\u542f\u7528\u6807\u5fd7\" field='yxbz'></div>\n            <div name=\"\u6536\u94f6\u65b9\u5f0f\" field='posList|posname'></div>\n            <div name=\"\u64cd\u4f5c\" colid=\"option\" template='option_template'></div>\n        </grid>\n    </div>\n</scroll-content>\n"}