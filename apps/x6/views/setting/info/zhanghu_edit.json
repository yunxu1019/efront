{"controller":"[\"$scope\", \"cache\", \"$filter\", \"clone\", \"tips\", function($scope,cache,$filter,clone,tips){\r\n    $scope.bar=[\"\u8d26\u6237\u4fe1\u606f\",\"\u5173\u8054\u6253\u6b3e\u95e8\u5e97\"];\r\n    $scope.isprev=false;\r\n    $scope.isnext=!$scope.isprev;\r\n    $scope.active=0;\r\n    $scope.slideLeft=false;\r\n    //\u5bc4\u5b58\u9009\u4e2d\u95e8\u5e97\u7684id\r\n\tconsole.log($scope.data)\r\n    var selectedShop=$scope.data.yxmd.split(\",\");\r\n    console.log(selectedShop)\r\n    for(var i=0;i<selectedShop.length;i++){\r\n    \tif(selectedShop[i]==\"\"){\r\n    \t\tselectedShop.splice(i,1);\r\n    \t}\r\n    }\r\n    $scope.zhlx=[\r\n    \t{id:0,name:\"\u5bf9\u516c\"},\r\n    \t{id:1,name:\"\u5bf9\u79c1\"}\r\n    ];\r\n    $scope.zh=clone.object($scope.data);\r\n    if($scope.zh.zhlx){\r\n    \t$scope.zh.zhlx={id:1,name:\"\u5bf9\u79c1\"}\r\n    }else{\r\n    \t$scope.zh.zhlx={id:0,name:\"\u5bf9\u516c\"}\r\n    }\r\n\r\n    \r\n    //\u5206\u516c\u53f8\u5217\u8868&&\u95e8\u5e97\u5217\u8868\r\n    $scope.company=getFgsAndShop(cache.gslist).company;\r\n    $scope.shop=getFgsAndShop(cache.gslist,selectedShop).shop;\r\n    //\u83b7\u53d6\u5206\u516c\u53f8\u4e0b\u9009\u4e2d\u7684\u95e8\u5e97\u6570\u91cf\r\n    $scope.company.forEach(function(_company){\r\n    \tvar sum=0;\r\n    \tvar mdArray=$filter(\"shopfilter\")($scope.shop,_company.bm);\r\n    \tmdArray.map(function(i){\r\n    \t\tif(i.issel){\r\n    \t\t\tsum++;\r\n    \t\t\tif(sum==mdArray.length){\r\n    \t\t\t\t_company.isall=true;\r\n    \t\t\t}\r\n\t\t\t\tif(selectedShop.indexOf(i.id.toString())==-1){\r\n\t\t\t\t\tselectedShop.push(i.id);\r\n\t\t\t\t}\r\n    \t\t}else{\r\n    \t\t\t_company.isall=false;\r\n    \t\t\tif(selectedShop.indexOf(i.id.toString())!=-1){\r\n\t\t\t\t\tselectedShop.splice(selectedShop.indexOf(i.id),1);\r\n\t\t\t\t}\r\n    \t\t}\r\n    \t})\r\n    \t_company.sl=sum;\r\n    })\r\n    $scope.switchMain=function(num){\r\n    \t$scope.slideLeft=$scope.isprev=$scope.active=num;\r\n    \t$scope.isnext=num?0:1;\r\n    }\r\n    //\u70b9\u51fb\u9009\u4e2d\u95e8\u5e97\r\n    $scope.selectShop=function(bm,obj){\r\n    \t//console.log($scope.shop)\r\n    \tvar sum=0;\r\n    \tvar mdArray=$filter(\"shopfilter\")($scope.shop,bm);\r\n    \tmdArray.map(function(i){\r\n    \t\tif(i.issel){\r\n    \t\r\n    \t\t\tsum++;\r\n    \t\t\tif(sum==mdArray.length){\r\n    \t\t\t\tobj.isall=true;\r\n    \t\t\t}\r\n    \t\t\t\r\n\t\t\t\tif(selectedShop.indexOf(i.id.toString())==-1){\r\n\t\t\t\t\tselectedShop.push(i.id.toString());\r\n\t\t\t\t\t//console.log(selectedShop)\r\n\t\t\t\t}\r\n    \t\t}else{\r\n    \t\t\tobj.isall=false;\r\n    \t\t\tif(selectedShop.indexOf(i.id.toString())!=-1){\r\n\t\t\t\t\tselectedShop.splice(selectedShop.indexOf(i.id.toString()),1);\r\n\t\t\t\t\t//console.log(selectedShop)\r\n\t\t\t\t}\r\n    \t\t}\r\n    \t})\r\n    \tobj.sl=sum;\r\n\t\t//console.log(selectedShop)\r\n    \t//console.log(obj)\r\n    }\r\n    //\u5168\u9009\r\n    $scope.allSelect=function(bm,obj,isall){\r\n    \tvar mdArray=$filter(\"shopfilter\")($scope.shop,bm);\r\n    \tmdArray.map(function(i){\r\n    \t\tif(isall){\r\n    \t\t\ti.issel=true;\r\n    \t\t\tif(selectedShop.indexOf(i.id.toString())==-1){\r\n\t\t\t\t\tselectedShop.push(i.id.toString());\r\n\t\t\t\t\tobj.sl++;\r\n\t\t\t\t}\r\n\t    \t}else{\r\n\t    \t\ti.issel=false;\r\n\t    \t\tif(selectedShop.indexOf(i.id.toString())!=-1){\r\n\t\t\t\t\tselectedShop.splice(selectedShop.indexOf(i.id.toString()),1);\r\n\t\t\t\t\tobj.sl--;\r\n\t    \t\t}\r\n\t    \t}\r\n    \t})\r\n    \t//console.log(selectedShop)\r\n    }\r\n    //\u4fdd\u5b58\u4fe1\u606f\r\n    $scope.save=function(){\r\n    \tvar tempobj=clone.object($scope.zh);\r\n    \ttempobj.zhlx=tempobj.zhlx.id;\r\n    \ttempobj.yxmd=selectedShop.join(\",\");\r\n    \t[\"allowdk\",\"comment\",\"gsdm\",\"isdelete\",\"ssgsid\",\"$$hashKey\"].map(function(i){\r\n    \t\tdelete tempobj[i];\r\n    \t});\r\n    \tapi(\"/x6/saveYhzh.do\",tempobj).onsuccess(function(data){\r\n    \t\ttips.success(\"\u4fee\u6539\u6210\u529f\");\r\n    \t\tif(data.zhlx)\r\n\t\t\t\tdata.zhlx=\"\u5bf9\u79c1\";\r\n    \t\telse\r\n\t\t\t\tdata.zhlx=\"\u5bf9\u516c\";\r\n    \t\tfor(key in $scope.data){\r\n    \t\t\t$scope.data[key]=data.yhzh[key]\r\n\t\t\t}\r\n            //$scope.data.khh=data.yhzh.khh;\r\n    \t\t//console.log($scope.data)\r\n    \t\t$scope.$CloseView();\r\n    \t})\r\n    }\r\n    //\u53d6\u51fa\u5206\u516c\u53f8\u53ca\u95e8\u5e97\r\n    function getFgsAndShop(obj,selectedShop){\r\n    \tvar company=[];\r\n    \tvar shop=[];\r\n    \tfor(var i=0,len=obj.length;i<len;i++){\r\n    \t\tif(obj[i].lx==2){\r\n    \t\t\tobj[i].sl=0;\r\n    \t\t\tcompany.push(obj[i]);\r\n    \t\t}\r\n    \t\tif(obj[i].lx==3){\r\n    \t\t\tif(selectedShop&&selectedShop[0]){\r\n    \t\t\t\tif(selectedShop.indexOf(obj[i].id.toString())!=-1){\r\n    \t\t\t\t\tobj[i].issel=true;\r\n    \t\t\t\t\t\r\n    \t\t\t\t}\r\n    \t\t\t}\r\n    \t\t\tshop.push(obj[i]);\r\n    \t\t}\r\n    \t}\r\n    \treturn {\r\n    \t\tcompany:company,\r\n    \t\tshop:shop\r\n    \t}\r\n    }\r\n}]","template":"<style>.setting-info-zhanghu_edit p {\n  width: 55%;\n  margin: 25px auto;\n  border: 1px solid #4385F3;\n  border-radius: 3px ;\n  font-size: 0;\n}\n.setting-info-zhanghu_edit p > span {\n  width: 50%;\n  line-height: 25px;\n  text-align: center;\n  display: inline-block;\n  font-size: 14px;\n  color: #4385F3;\n  cursor: pointer;\n}\n.setting-info-zhanghu_edit p > span.selected {\n  background: #4385F3;\n  color: #fff;\n}\n.setting-info-zhanghu_edit .add-main {\n  width: 200%;\n  height: -webkit-calc(100% - 133px);\n  height: calc(100% - 133px);\n  overflow: hidden;\n  -webkit-transition: all .2s;\n  transition: all .2s;\n}\n.setting-info-zhanghu_edit .add-main > div {\n  width: 50%;\n  height: 100%;\n  font-size: 14px;\n  float: left;\n}\n.setting-info-zhanghu_edit .add-main > div:first-child > div {\n  width: 325px;\n  margin: 10px auto;\n}\n.setting-info-zhanghu_edit .add-main > div:first-child > div > span {\n  display: block;\n  width: 70px;\n  line-height: 30px;\n  float: left;\n}\n.setting-info-zhanghu_edit .add-main > div:first-child > div > .text-input,\n.setting-info-zhanghu_edit .add-main > div:first-child > div > .selector {\n  height: 30px;\n}\n.setting-info-zhanghu_edit .add-main > div:first-child > div > .on-off {\n  margin-left: 0;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div {\n  width: 90%;\n  height: 100%;\n  margin: 0 5%;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div > .items {\n  width: 100%;\n  margin-top: 15px;\n  overflow: hidden;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div > .items > .item-title > div {\n  display: inline-block;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div > .items > .item-title > div > .checkbox {\n  margin-right: 5px;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div > .items > .item-shop {\n  width: 22%;\n  line-height: 20px;\n  padding: 0 2px;\n  margin-left: 2%;\n  margin-top: 10px;\n  border: 1px dashed #ccc;\n  float: left;\n  cursor: pointer;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  text-align: center;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div > .items > .selected {\n  border: 1px solid #4385F3;\n  color: #4385F3;\n}\n.setting-info-zhanghu_edit .add-main > div:nth-child(2) > div > .items > .item-shop:nth-child(4n-2) {\n  margin-left: 0;\n}\n.setting-info-zhanghu_edit .switch-control {\n  -webkit-transform: translateX(-50%);\n      -ms-transform: translateX(-50%);\n          transform: translateX(-50%);\n}\n.setting-info-zhanghu_edit .add-control {\n  padding: 15px 15px 15px 0;\n  border-top: 1px solid #ddd ;\n  background: #f2f2f2;\n  text-align: right;\n}\n.setting-info-zhanghu_edit .add-control > .anniu {\n  cursor: pointer;\n  margin-left: 10px;\n}\n</style><p>\r\n\t<span ng-repeat=\"item in bar\" ng-bind=\"item\" ng-class=\"{'selected':active==$index}\"></span>\r\n</p>\r\n<div class=\"add-main\" ng-class=\"{'switch-control':slideLeft}\">\r\n\t<div>\r\n\t\t<div>\r\n\t\t\t<span>\u94f6\u884c\u540d\u79f0</span>\r\n\t\t\t<text-input ng-model=\"zh.zhname\"></text-input>\r\n\t\t</div>\r\n\t\t<div>\r\n\t\t\t<span>\u5f00\u6237\u884c</span>\r\n\t\t\t<text-input ng-model=\"zh.khh\"></text-input>\r\n\t\t</div>\r\n\t\t<div>\r\n\t\t\t<span>\u8d26\u53f7</span>\r\n\t\t\t<text-input ng-model=\"zh.zh\"></text-input>\r\n\t\t</div>\r\n\t\t<div>\r\n\t\t\t<span>\u8d26\u6237\u7c7b\u578b</span>\r\n\t\t\t<selector source=\"zhlx\" field=\"name\" ng-model=\"zh.zhlx\"></selector>\r\n\t\t</div>\r\n\t\t<div>\r\n\t\t\t<span>\u94f6\u884c\u540d\u79f0</span>\r\n\t\t\t<on-off yxbz=\"zh.yxbz\"></on-off>\r\n\t\t</div>\r\n\t\t\r\n\t</div>\r\n\t<div>\r\n\t\t<div>\r\n\t\t\t<div class=\"items\" ng-repeat=\"fgs in company\" ng-if=\"(shop|shopfilter:fgs.bm).length\">\r\n\t\t\t\t<div class=\"item-title\"><div ng-click=\"allSelect(fgs.bm,fgs,fgs.isall)\"><checkbox ng-model=\"fgs.isall\"></checkbox></div>{{fgs.name}}&emsp;{{fgs.sl}}/{{(shop|shopfilter:fgs.bm).length}}</div>\r\n\t\t\t\t<div class=\"item-shop\" ng-repeat=\"md in shop|shopfilter:fgs.bm\" ng-bind=\"md.name\" ng-click=\"md.issel=!md.issel;selectShop(fgs.bm,fgs)\" ng-class=\"{'selected':md.issel}\"></div>\t\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n<div class=\"add-control\">\r\n\t<!--<anniu ng-click='switchMain(1)' ng-if=\"isnext\">\u786e\u8ba4</anniu>-->\r\n\t<anniu candidate ng-click='switchMain(0)' ng-if=\"isprev\">\u4e0a\u4e00\u6b65</anniu>\r\n\t<anniu candidate ng-click='switchMain(1)' ng-if=\"isnext\">\u4e0b\u4e00\u6b65</anniu>\r\n\t<anniu ng-click='save()' ng-if=\"isprev\">\u4fdd\u5b58</anniu>\r\n</div>"}