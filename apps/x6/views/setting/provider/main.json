{"controller":" [\"$scope\", \"isChildElement\", \"$document\", \"popup\", \"alert\", \"api\", \"user\", \"alert\", \"getScreenPosition\", \"$compile\", function ($scope, isChildElement, $document, popup, alert, api, user, alert, getScreenPosition, $compile) {\r\n\t//\u70b9\u51fb\u7a7a\u767d\u5904\u540e\uff0c\u5173\u95ed\u7a97\u53e3\r\n    var close_time = 0;\r\n    var onmouseup = function (event) {\r\n        var popup = getRootElementInPopup(event.target);\r\n        if (!popup) {\r\n            close_time = setTimeout(function () {\r\n                if (event.prevented) {\r\n                    return;\r\n                }\r\n                if (\r\n                        view //\u5b58\u5728\u5f39\u7a97\r\n                        ) {\r\n                    //\u5173\u95ed\u5f39\u7a97\r\n                    history.back();\r\n                }\r\n            }, 20);\r\n        }\r\n    };\r\n    $document.on('mouseup', onmouseup);\r\n    $scope.$on(\"$destory\", function () {\r\n        $document.off('mouseup', onmouseup);\r\n        view && view.close();\r\n    });\r\n\r\n    var view;\r\n    \r\n    $scope.filter = function () {\r\n        $scope.filter.ing = !$scope.filter.ing;\r\n    };\r\n    //\u663e\u793a\u72b6\u6001\r\n    $scope.xschoose = false;\r\n    $scope.displayChoose = function () {\r\n        $scope.xschoose = true;\r\n    };\r\n    $scope.hideChoose = function () {\r\n        $scope.xschoose = false;\r\n    };\r\n        \r\n    $scope.yxbz = {\r\n        qy: 1,\r\n        wqy: 0\r\n        \r\n    };\r\n    var yxbz = {\r\n        \"0\": \"qy\",\r\n        \"1\": \"wqy\"       \r\n    };\r\n    \r\n    $scope.ren_template = \"<span>{{$.lxr}}&nbsp;<span >{{$.phone}}</span></span>\";\r\n    //\u91cd\u7ec4\u8868\u683c\u6570\u636e\r\n    var rebuild = function () {\r\n        var providers = [];\r\n        var yx_providers = $scope.yx_providers;\r\n        for (var k in yxbz) {\r\n            var kk = yxbz[k];\r\n            if ($scope.yxbz[kk]) {\r\n                if (yx_providers[kk]) {\r\n                    providers.push.apply(providers, yx_providers[kk]);\r\n                } else {\r\n                    getProviderList(k, kk);\r\n                }\r\n            }\r\n        }      \r\n        $scope.providers = providers;\r\n    };\r\n    //\u91cd\u5efa\u6e90\u6570\u636e\r\n    var refresh = function () {\r\n        var yx_providers = $scope.yx_providers;\r\n        for (var k in yxbz) {\r\n            var kk = yxbz[k];\r\n            if ($scope.yxbz[kk]) {\r\n                getProviderList(k, kk);\r\n            } else {\r\n                delete yx_providers[kk];\r\n            }\r\n        }\r\n    };\r\n    //\u767b\u5f55\r\n    user.onlogin=refresh;\r\n    $scope.yx_providers = {};\r\n    $scope.$watch('yxbz', rebuild, true);\r\n    $scope.$watch(\"yx_providers\", rebuild);\r\n    //\u4f9b\u5e94\u5546\u5217\u8868\r\n    var getProviderList = function (k,kk) {\r\n        $scope.providers = [];\r\n        var params = {\r\n        \tlx:1,\r\n            yxbz: k//\u6709\u6548\u6807\u5fd7\r\n        };\r\n        api('/x6/getDmJgList.do', params).onsuccess(function (data) {\r\n\t\t\tvar temp = $scope.yx_providers;\r\n            var yx_providers = {};\r\n            yx_providers[kk] = data.dmjglist;\r\n            delete temp[kk];\r\n            angular.extend(yx_providers, temp);\r\n            $scope.yx_providers = yx_providers;\r\n        });\r\n    };\r\n    \r\n   \t$scope.checked = [];\r\n    $scope.$watch('checked.length', function (len) {\r\n        $scope.shtop = len;        \r\n    });\r\n    $scope.showCancel = function () {\r\n        $scope.shtop = 0;       \r\n    };\r\n    \r\n    //\u6279\u91cf\u5220\u9664    \r\n    var bachRemove = function () {\r\n        var checked = $scope.checked;\r\n        alert(\"\u786e\u5b9a\u5220\u9664\u5df2\u9009\u7684\"+ checked.length + \"\u4e2a\u4f9b\u5e94\u5546\u5417\uff1f\", {\r\n            \"\u786e\u8ba4\": function () {\r\n                api('/x6/deleteDmJgBatch.do', {\r\n                    ids: checked.map(function (obj) {\r\n                        return obj.id;\r\n                    }).join(',')\r\n                }).onsuccess(function (data) {\r\n                    alert.success(\"\u5220\u9664\u6210\u529f\");\r\n                    refresh();\r\n                });\r\n            },\r\n            \"\u53d6\u6d88\": function () {\r\n            \t\r\n            }\r\n        }).warn();\r\n    };\r\n    $scope.bachDelete = bachRemove;\r\n    //\u65b0\u589e\u4f9b\u5e94\u5546\u4fe1\u606f\r\n//  $scope.add = function () {\r\n//      popup(\"/setting/provider/add\", {\r\n//          \"$ViewTitle\": \"\u65b0\u589e\u4f9b\u5e94\u5546\",\r\n//          \"$ViewOptions\": {\r\n//              \"\u4fdd\u5b58\": function () {\r\n//\t\t\t\t\t\r\n//              },\r\n//              \"\u5173\u95ed\": function () {\r\n//\r\n//              }\r\n//          }\r\n//      }, {width: 400, height: 500}).onclose(refresh);\r\n//  };\r\n    $scope.add = function () {\r\n        popup(\"/setting/provider/add\", {\r\n            \"$ViewTitle\": \"\u65b0\u589e\u5458\u5de5\u4fe1\u606f\",\r\n//          \"yx_providers\":$scope.yx_providers\r\n        }, {width: 500, height: 500}).onclose(function(userInfo){\r\n//           userInfo&&refresh();\r\n\t\t\t console.log(userInfo)\r\n\t\t\t refresh();\r\n        });\r\n    };\r\n    //\u7f16\u8f91\u4f9b\u5e94\u5546\u4fe1\u606f\r\n    $scope.edit = function ($, $data) {\r\n    \tclearTimeout(close_time);\r\n        if (view) {\r\n            view.data({data: $});\r\n            return;\r\n        }\r\n        view = popup('/setting/provider/edit', {\r\n            data: $,\r\n            $ViewStyle: {\r\n                position: \"absolute\",\r\n                left: \"0\",\r\n                top: '0',\r\n                height: \"100%\",\r\n                width: \"100%\",\r\n                border:'1px solid #e2e3e5',\r\n                borderRadius:'1px',\r\n                boxShadow:'0 0 5px rgba(0,0,0,0.1)'\r\n            }\r\n        }).css({\r\n            right: '10px',\r\n            top: '110px',            \r\n            bottom: '0px',\r\n            left:'400px', \r\n            background: 'transparent',            \r\n        }).nobackground().solid().right().onclose(function () {\r\n            view = null;\r\n            refresh();\r\n        });\r\n    };\r\n    //\u5bfc\u51fa\r\n    $scope.export = function () {\r\n        popup(\"/setting/provider/export\", {\r\n            \"$ViewTitle\": \"\u5bfc\u51fa\u683c\u5f0f\u9009\u62e9\",           \r\n        }, {width: 400, height: 300}).onclose(function(userInfo){\r\n            \r\n        });\r\n    };\r\n}]","template":"<style>.setting-provider-main .top-bar {\n  height: 50px;\n  line-height: 50px;\n  background-color: #f8f9fd;\n  text-align: right;\n  position: relative;\n  border-bottom: 2px solid #4385f5;\n}\n.setting-provider-main .top-box1 {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  padding: 0 10px;\n}\n.setting-provider-main .top-box1 > .anniu {\n  background: #26bf8c;\n  padding: 0 10px;\n}\n.setting-provider-main .top-box1 > a {\n  float: left;\n}\n.setting-provider-main .top-box1 > a > span {\n  font-size: 15px;\n}\n.setting-provider-main .top-box1 > a > span:hover {\n  cursor: pointer;\n}\n.setting-provider-main .top-box1 > a > span:hover > i {\n  color: #4385F3;\n}\n.setting-provider-main .top-box1 > a > span > i {\n  display: inline-block;\n  vertical-align: middle;\n  font-size: 12px;\n  color: #888;\n  margin-left: 3px;\n}\n.setting-provider-main .top-box1 > a > div.choose {\n  width: 128px;\n  height: auto;\n  background: #fff;\n  z-index: 10;\n  position: absolute;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);\n  top: 50px;\n}\n.setting-provider-main .top-box1 > a > div.choose > div {\n  text-align: left;\n  padding: 0 10px;\n  line-height: 44px;\n}\n.setting-provider-main .top-box1 > a > div.choose > div:hover {\n  background-color: #e9ecf2;\n}\n.setting-provider-main .slide-left {\n  -webkit-transition: 0.1s -webkit-transform ease-out;\n  transition: 0.1s -webkit-transform ease-out;\n  transition: 0.1s transform ease-out;\n  transition: 0.1s transform ease-out, 0.1s -webkit-transform ease-out;\n}\n.setting-provider-main .slide-left.ng-enter,\n.setting-provider-main .slide-left.ng-leave {\n  opacity: 0;\n  -webkit-transform: translateX(-100%);\n      -ms-transform: translateX(-100%);\n          transform: translateX(-100%);\n}\n.setting-provider-main .blue {\n  color: #558ef6;\n  font-size: 16px;\n}\n.setting-provider-main .top-box2 {\n  position: absolute;\n  left: 0;\n  right: 20px;\n}\n.setting-provider-main .top-box2 > div,\n.setting-provider-main .top-box2 > .anniu {\n  color: #324057;\n  height: 50px;\n  vertical-align: top;\n  display: inline-block;\n  padding: 0 19px;\n  position: relative;\n  float: left;\n}\n.setting-provider-main .top-box2 > div:hover,\n.setting-provider-main .top-box2 > .anniu:hover {\n  cursor: pointer;\n}\n.setting-provider-main .top-box2 > div:hover i,\n.setting-provider-main .top-box2 > .anniu:hover i {\n  color: #4c8bf5;\n}\n.setting-provider-main .top-box2 > div:hover span,\n.setting-provider-main .top-box2 > .anniu:hover span {\n  color: #4c8bf5;\n}\n.setting-provider-main .top-box2 > div > .bo-right,\n.setting-provider-main .top-box2 > .anniu > .bo-right {\n  width: 1px;\n  height: 14px;\n  background: #ccc;\n  position: absolute;\n  right: 0;\n  top: 19px;\n}\n.setting-provider-main .top-box2 > div > .bo-left,\n.setting-provider-main .top-box2 > .anniu > .bo-left {\n  width: 1px;\n  height: 14px;\n  background: #ccc;\n  position: absolute;\n  left: 0;\n  top: 19px;\n}\n.setting-provider-main .top-box2 > div span,\n.setting-provider-main .top-box2 > .anniu span {\n  vertical-align: top;\n}\n.setting-provider-main .top-box2 > div i,\n.setting-provider-main .top-box2 > .anniu i {\n  vertical-align: top;\n  color: #8ea4bb;\n  font-size: 20px;\n}\n.setting-provider-main .top-box2 > div i:hover,\n.setting-provider-main .top-box2 > .anniu i:hover {\n  color: #4c8bf5;\n}\n.setting-provider-main .top-box2 > div .icon-guanbi3,\n.setting-provider-main .top-box2 > .anniu .icon-guanbi3 {\n  font-size: 25px;\n}\n.setting-provider-main .top-box2 > a {\n  cursor: pointer;\n  text-align: right;\n  font-size: 22px;\n  color: #999;\n  float: right;\n}\n.setting-provider-main .grid {\n  position: absolute;\n  left: 10px;\n  right: 10px;\n  bottom: 10px;\n  top: 50px;\n  -webkit-transition: top 0.1s ease-out;\n  transition: top 0.1s ease-out;\n  width: auto;\n  height: auto;\n}\n</style><div class=\"top-bar\">\r\n    <div class=\"top-box1 \" ng-if=\"!shtop\">\r\n        <a ng-mouseleave=\"hideChoose()\">\r\n            <span ng-mouseover=\"displayChoose()\">\u72b6\u6001<i class=\"iconfont icon-xiajiantou\"></i></span>\r\n            <div class=\"choose\" ng-show=\"xschoose\">\r\n                <div ng-click='yxbz.qy = 1 - yxbz.qy'><checkbox ng-model=\"yxbz.qy\" disabled>\u542f\u7528</checkbox></div>\r\n                <div ng-click='yxbz.wqy = 1 - yxbz.wqy'><checkbox ng-model=\"yxbz.wqy\" disabled>\u672a\u542f\u7528</checkbox></div>                 \r\n            </div>\r\n        </a>                  \t\r\n        <anniu ng-click=\"add()\">\u65b0\u589e</anniu>   \t\r\n    </div>\r\n    \r\n    <div class='top-box2 slide-left' ng-if=\"shtop\">    \t\r\n        <div >\u5df2\u9009\u4e2d<span class=\"blue\">{{checked.length}}</span>\u9879<div class=\"bo-right\"></div></div>        \r\n        <div ng-click=\"bachDelete()\"><i class=\"iconfont icon-guanbi3\"></i>&nbsp;&nbsp;<span ng-show='!bachDelete.ing'>\u5220\u9664</span><span style=\"color:#f00\" ng-show='bachDelete.ing'>\u518d\u70b9\u4e00\u6b21\u5220\u9664</span><div class=\"bo-right\"></div></div>  \r\n        <div ng-click=\"export()\"><i class=\"iconfont icon-daochu\"></i>&nbsp;&nbsp;<span>\u5bfc\u51fa</span></div>\r\n        <a ng-click=\"showCancel()\"><i>\u2573</i></a>\r\n    </div>\r\n</div>\r\n\r\n<grid ng-model=\"providers\" show-filter=\"true\" multi-select=\"true\" checked=\"checked\" class=noline>  \r\n    <div field=\"name\" name=\"\u540d\u79f0\" ng-click=\"edit($, $data)\" ng-style=\"{'color':'#4385f5','cursor':'pointer'}\" ></div> \r\n    <div template='ren_template' align='left' nofilter name=\"\u8054\u7cfb\u4eba\u4fe1\u606f\" ></div>\r\n    <div field=\"dz\" name=\"\u5730\u5740\" ></div>\r\n    <div field=\"ysyf\" name=\"\u671f\u521d\u5e94\u4ed8\u6b3e\" ></div>\r\n    <div field=\"yxbz\" name=\"\u542f\u7528\u6807\u5fd7\" format=\"translate:{'0':'\u542f\u7528','1':'\u672a\u542f\u7528'}\"></div>\r\n    <div field=\"comments\" name=\"\u5907\u6ce8\" ></div>\r\n</grid>  "}