{"controller":" [\"$scope\", \"popup\", \"api\", \"user\", \"cache\", function ($scope, popup, api, user, cache) {\n    //console.log(cache)\n    $scope.retail = {\n        splxbm: \"\",\n        tag: \"\",\n        pp: \"\",\n        spmc: \"\",\n        qspmc: \"\",\n        showZero: 0\n    };\n    $scope.splxList = cache.splxList;\t//\u5546\u54c1\u7c7b\u578b\u5217\u8868\n\n    api('/x6/getSearchPpList.do', {value: \"\"}).onsuccess(function (data) {\n        //console.log(data);\n        $scope.ppList = data.ppList; //\u54c1\u724c\u5217\u8868\n    });\n\n    api('/x6/getDmSpxxTagsList.do', {}).onsuccess(function (data) {\n        $scope.tagsList = data.tagsList; //\u6807\u7b7e\u5217\u8868\n    });\n    $scope.getonSplxList = function () {\n        refresh();\n    };\n    $scope.getontagList = function () {\n        refresh();\n    };\n\n    $scope.$watch(\"retail.spmc\", function () {\n        if ($scope.spxxList) {\n            if ($scope.spxxList.length > 0) {\n                for (var i = 0; i < $scope.spxxList.length; i++) {\n                    if ($scope.spxxList[i].checked3 === true) {\n                        $scope.retail.qspmc = $scope.spxxList[i].qspmc;\n                    }\n                }\n            } else {\n                $scope.retail.qspmc = \"\";\n            }\n        }\n        if ($scope.xhList) {\n            if ($scope.xhList.length > 0) {\n                for (var i = 0; i < $scope.xhList.length; i++) {\n                    if ($scope.xhList[i].checked2 === true) {\n                        $scope.retail.spmc1 = $scope.xhList[i].spmc;\n                    }\n                }\n            } else {\n                $scope.retail.spmc1 = \"\";\n            }\n        }\n        if ($scope.ppList) {\n            for (var i = 0; i < $scope.ppList.length; i++) {\n                if ($scope.ppList[i].checked === true) {\n                    $scope.retail.pp = $scope.ppList[i].pp;\n                }\n            }\n        } else {\n            $scope.retail.pp = \"\";\n        }\n        refresh();\n    }, true);\n    $scope.selectPpList = function (obj, index) {\n        //console.log(obj,index);\n        $scope.ppList[index].checked = !$scope.ppList[index].checked;\n        for (var i = 0; i < $scope.ppList.length; i++) {\n            if (i !== index) {\n                $scope.ppList[i].checked = false;\n            }\n        }\n        //\u83b7\u53d6\u578b\u53f7\u5217\u8868\n        if ($scope.ppList[index].checked === true) {\n            api('/x6/getSpmcList.do', {value: \"\", pp: obj.pp}).onsuccess(function (data) {\n                $scope.xhList = data.spmcList;\n            });\n        } else {\n            $scope.xhList = [];\n        }\n\n    };\n\n    $scope.selectXhList = function (xh, index, event) {\n        event.stopPropagation();\n        $scope.xhList[index].checked2 = !$scope.xhList[index].checked2;\n        for (var i = 0; i < $scope.xhList.length; i++) {\n            if (i !== index) {\n                $scope.xhList[i].checked2 = false;\n            }\n        }\n        if ($scope.xhList[index].checked2 === true) {\n            api('/x6/getSpxxListBySpmc.do', {spmc: xh.spmc}).onsuccess(function (data) {\n                $scope.spxxList = data.spxxList;\n            });\n        } else {\n            $scope.spxxList = [];\n        }\n    };\n    $scope.selectSpxxList = function (sp, index, event) {\n        event.stopPropagation();\n        $scope.spxxList[index].checked3 = !$scope.spxxList[index].checked3;\n        for (var i = 0; i < $scope.spxxList.length; i++) {\n            if (i !== index) {\n                $scope.spxxList[i].checked3 = false;\n            }\n        }\n    };\n    $scope.showHp = function () {\n        $scope.hpchecked = true;\n    };\n    $scope.selectHpPp = function (obj, index, event) { //\u9009\u62e9\u54c1\u724c\u53cc\u51fb\n        event.stopPropagation();\n        obj.checked = true;\n        if ($scope.xhList) {\n            for (var i = 0; i < $scope.xhList.length; i++) {\n                $scope.xhList[i].checked2 = false;\n            }\n        }\n        if ($scope.spxxList) {\n            for (var i = 0; i < $scope.spxxList.length; i++) {\n                $scope.spxxList[i].checked3 = false;\n            }\n        }\n\n        $scope.hpchecked = false;\n        $scope.retail.spmc = obj.pp;\n    };\n    $scope.selectHpSpmc = function (obj, index, event) { //\u9009\u62e9\u5546\u54c1\u540d\u79f0\u53cc\u51fb\n        event.stopPropagation();\n        $scope.hpchecked = false;\n        $scope.retail.spmc = obj.spmc;\n        obj.checked2 = true;\n        if ($scope.spxxList) {\n            for (var i = 0; i < $scope.spxxList.length; i++) {\n                $scope.spxxList[i].checked3 = false;\n            }\n        }\n    };\n    $scope.selectHpSpxx = function (obj, index, event) {  //\u9009\u62e9\u5546\u54c1\u5168\u79f0\u53cc\u51fb\n        event.stopPropagation();\n        $scope.hpchecked = false;\n        $scope.retail.spmc = obj.qspmc;\n        obj.checked3 = true;\n    };\n\n\n    $scope.$watch(\"retail.showZero\", function () {\n        refresh();\n    }, true);\n\n    // \u96f6\u552e\u8003\u6838\u5217\u8868   \n    var getDmKhList = function (k, kk) {\n        $scope.retails = [];\n        var params = {\n            splx: $scope.retail.splxbm,\n            tag: $scope.retail.tag,\n            yxbz: k,\n            showZero: $scope.retail.showZero,\n            pp: $scope.retail.pp,\n            spmc: $scope.retail.spmc1,\n            qspmc: $scope.retail.qspmc\n        };\n        api('/x6/getDmKhList.do', params).onsuccess(function (data) {\n            var list = data.khList;\n            var spStatus = \"\";\n            for (var i = 0; i < list.length; i++) {\n                var tag = list[i].tags.value;\n                if (tag !== \"[]\") {\n                    var valueList = tag.split('[')[1].split(']')[0].split(',');\n                    for (var j = 0; j < valueList.length; j++) {\n                        spStatus += valueList[j].split('{\"')[1].split('\"}')[0].split(\":\")[1].split('\"')[1];\n                    }\n                }\n                data.khList[i].spStatus = spStatus;\t  //\u8d27\u54c1\u72b6\u6001\n                data.khList[i].kcjj = 0;                //\u5e93\u5b58\u5747\u4ef7\n                data.khList[i].zjjj = 0;                //\u6700\u8fd1\u5747\u4ef7\n            }\n            var temp = $scope.yx_retails;\n            var yx_retails = {};\n            yx_retails[kk] = data.khList;\n            delete temp[kk];\n            angular.extend(yx_retails, temp);\n            $scope.yx_retails = yx_retails;\n        });\n    };\n\n    //\u663e\u793a\u72b6\u6001\n    $scope.xschoose = false;\n    $scope.displayChoose = function () {\n        $scope.xschoose = true;\n    };\n    $scope.hideChoose = function () {\n        $scope.xschoose = false;\n    };\n    $scope.yxbz = {\n        qy: 1,\n        wqy: 0\n    };\n    var yxbz = {\n        \"0\": \"qy\",\n        \"1\": \"wqy\"\n    };\n\n    //\u4fee\u6539\u8003\u6838\u4ef7\n    $scope.$watch(\"retails\", function ($) {\n        for (var i = 0; i < $.length; i++) {\n            var params = {\n                id: $[i].id,\n                datafield: \"a\",\n                value: $[i].a\n            };\n            var params2 = {\n                id: $[i].id,\n                datafield: \"xsxj\",\n                value: $[i].xsxj\n            };\n            savePrice(params);\n            savePrice(params2);\n        }\n    }, true);\n    var savePrice = function (params) {\n        api('/x6/updatePrice.do', params).onsuccess(function (data) {\n\n        });\n    };\n    //\u91cd\u7ec4\u8868\u683c\u6570\u636e\n    var rebuild = function () {\n        var retails = [];\n        var yx_retails = $scope.yx_retails;\n        for (var k in yxbz) {\n            var kk = yxbz[k];\n            if ($scope.yxbz[kk]) {\n                if (yx_retails[kk]) {\n                    retails.push.apply(retails, yx_retails[kk]);\n                } else {\n                    getDmKhList(k, kk);\n                }\n            }\n        }\n        $scope.retails = retails;\n    };\n    //\u91cd\u5efa\u6e90\u6570\u636e\n    var refresh = function () {\n        var yx_retails = $scope.yx_retails;\n        for (var k in yxbz) {\n            var kk = yxbz[k];\n            if ($scope.yxbz[kk]) {\n                getDmKhList(k, kk);\n            } else {\n                delete yx_retails[kk];\n            }\n        }\n    };\n    //\u767b\u5f55\n    user.onlogin = refresh;\n    $scope.yx_retails = {};\n    $scope.$watch('yxbz', rebuild, true);\n    $scope.$watch(\"yx_retails\", rebuild);\n\n    //$\u8868\u5f0f\u4e00\u884c\u6570\u636e \u53d8\u4ef7\u8d70\u52bf\n    $scope.trend_template = function () {\n        return \"<span style='cursor:pointer;' ng-click='showtrend()'><img src='images/17.png'/></span>\";\n    }();\n\n    $scope.showtrend = function () {\n        popup(\"/setting/retail/trend\", {\n            \"$ViewTitle\": \"\u53d8\u4ef7\u8d70\u52bf\",\n            \"$ViewOptions\": {\n                \"\u5173\u95ed\": function () {\n                }\n            }\n        }, {width: 648, height: 720})\n    };\n}]","template":"<style>.setting-retail-retail_man .container {\n  border: 1px solid #e3e6eb;\n}\n.setting-retail-retail_man .container .top-bar {\n  height: 53px;\n  line-height: 53px;\n  padding: 0 10px;\n  text-align: right;\n  border-bottom: 2px solid #4385f5;\n  background-color: #f8f9fd;\n  overflow: hidden;\n}\n.setting-retail-retail_man .container .top-bar .field {\n  width: 352px;\n  position: absolute;\n  left: 100px;\n  text-align: justify;\n}\n.setting-retail-retail_man .container .top-bar .hpzt {\n  width: 352px;\n  position: absolute;\n  left: 630px;\n  text-align: justify;\n}\n.setting-retail-retail_man .container .top-bar .anniu {\n  position: absolute;\n  left: 1280px;\n  top: 15px;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin {\n  width: 352px;\n  position: absolute;\n  left: 430px;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > em {\n  float: left;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name {\n  float: left;\n  width: 250px;\n  border: 1px solid #e4e4e4;\n  border-radius: 3px;\n  height: 29px;\n  display: inline-block;\n  margin-top: 13px;\n  background: #fff;\n  position: relative;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > input {\n  width: 80%;\n  height: 90%;\n  margin-top: 2px;\n  border: none;\n  outline: none;\n  color: #666;\n  position: absolute;\n  top: 0;\n  left: 0;\n  padding-left: 15px;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 {\n  width: 100%;\n  position: absolute;\n  top: 29px;\n  left: 0;\n  z-index: 9999999;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items {\n  width: 100%;\n  line-height: 25px;\n  padding: 0 5%;\n  font-size: 12px;\n  cursor: pointer;\n  text-align: left;\n  background: #fff;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > i {\n  float: right;\n  color: #7eaaf5;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .close {\n  font-size: 12px;\n  color: #ccc;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .close:hover {\n  color: #4385f5;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 {\n  width: 100%;\n  position: absolute;\n  top: 0;\n  left: 249px;\n  z-index: 9999999;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 {\n  width: 100%;\n  line-height: 25px;\n  padding: 0 5%;\n  font-size: 12px;\n  cursor: pointer;\n  text-align: left;\n  background: #fff;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > i {\n  float: right;\n  color: #7eaaf5;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .close {\n  font-size: 12px;\n  color: #ccc;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .close:hover {\n  color: #4385f5;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .add-name4 {\n  position: absolute;\n  top: 0;\n  left: 249px;\n  width: 100%;\n  z-index: 9999999;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .add-name4 > .add-items3 {\n  width: 100%;\n  line-height: 25px;\n  padding: 0 5%;\n  font-size: 12px;\n  cursor: pointer;\n  text-align: left;\n  background: #fff;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .add-name4 > .add-items3 > i {\n  float: right;\n  color: #7eaaf5;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .add-name4 > .add-items3 > .close {\n  font-size: 12px;\n  color: #ccc;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .add-name4 > .add-items3 > .close:hover {\n  color: #4385f5;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .add-items2 > .add-name4 > .active {\n  background: #F1F2F3;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .add-items > .add-name3 > .active {\n  background: #F1F2F3;\n}\n.setting-retail-retail_man .container .top-bar > div.huopin > div.add-name > .add-name2 > .active {\n  background: #F1F2F3;\n}\n.setting-retail-retail_man .container .top-bar > a {\n  position: absolute;\n  left: 20px;\n}\n.setting-retail-retail_man .container .top-bar > a > span {\n  font-size: 15px;\n}\n.setting-retail-retail_man .container .top-bar > a > span:hover {\n  cursor: pointer;\n}\n.setting-retail-retail_man .container .top-bar > a > span:hover > i {\n  color: #4385F3;\n}\n.setting-retail-retail_man .container .top-bar > a > span > i {\n  display: inline-block;\n  vertical-align: middle;\n  font-size: 12px;\n  color: #888;\n  margin-left: 3px;\n}\n.setting-retail-retail_man .container .top-bar > a > div.choose {\n  width: 128px;\n  height: auto;\n  background: #fff;\n  z-index: 10;\n  position: absolute;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);\n  top: 50px;\n}\n.setting-retail-retail_man .container .top-bar > a > div.choose > div {\n  text-align: left;\n  padding: 0 10px;\n  line-height: 44px;\n}\n.setting-retail-retail_man .container .top-bar > a > div.choose > div:hover {\n  background-color: #e9ecf2;\n}\n.setting-retail-retail_man .container .grid {\n  position: absolute;\n  left: 10px;\n  right: 10px;\n  bottom: 10px;\n  top: 53px;\n  -webkit-transition: top 0.1s ease-out;\n  transition: top 0.1s ease-out;\n  width: auto;\n  height: auto;\n}\n</style><div class=\"container\" row-view>\r\n    <div class=\"top-bar\">\r\n    \t<a ng-mouseleave=\"hideChoose()\">\r\n            <span ng-mouseover=\"displayChoose()\">\u72b6\u6001<i class=\"iconfont icon-xiajiantou\"></i></span>\r\n            <div class=\"choose\" ng-show=\"xschoose\">\r\n                <div ng-click='yxbz.qy = 1 - yxbz.qy'><checkbox ng-model=\"yxbz.qy\" disabled>\u542f\u7528</checkbox></div>\r\n                <div ng-click='yxbz.wqy = 1 - yxbz.wqy'><checkbox ng-model=\"yxbz.wqy\" disabled>\u672a\u542f\u7528</checkbox></div> \r\n                <div ng-click='retail.showZero=1-retail.showZero'><checkbox ng-model=\"retail.showZero\" disabled>\u4e0d\u663e\u793a0</checkbox></div> \r\n            </div>\r\n        </a>\r\n        <field name=\u5546\u54c1\u7c7b\u578b><selector  ng-model='retail.splxbm' id-key=\"bm\" source='splxList' field=\"name\" noicon ng-change=\"getonSplxList()\" ></selector></field>                \r\n        <div class=\"huopin\">\r\n        \t<em>\u8d27\u54c1\uff1a</em>\r\n        \t<div class=\"add-name\" ng-click=\"showHp()\">\r\n\t\t\t\t<!--<text-input placeholder=\"\u8bf7\u8f93\u5165\u540d\u79f0\" ng-model=\"retail.spmc\"></text-input>-->\r\n\t\t\t\t<input type=\"text\" placeholder=\"\u8bf7\u9009\u62e9\" ng-model=\"retail.spmc\" readonly=\"readonly\"/>\r\n\t\t\t\t<div class=\"add-name2\">\r\n\t\t\t\t\t<div class=\"add-items {{item.checked ? 'active' : ''}}\" ng-repeat=\"item in ppList\" ng-click=\"selectPpList(item,$index)\" ng-dblclick=\"selectHpPp(item,$index,$event)\" ng-if=\"hpchecked\">\r\n\t\t\t\t\t\t{{item.pp}}<i class=\"iconfont icon-icon2\" ng-if=\"item.checked\"></i>\r\n\t\t\t\t\t\t<div class=\"add-name3\">\r\n\t\t\t\t\t\t\t<div class=\"add-items2 {{xh.checked2 ? 'active' : '' }}\" ng-repeat=\"xh in xhList\" ng-click=\"selectXhList(xh,$index,$event)\" ng-dblclick=\"selectHpSpmc(xh,$index,$event)\" >\r\n\t\t\t\t\t\t\t\t{{xh.spmc}}<i class=\"iconfont icon-icon2\" ng-if=\"xh.checked2\"></i>\r\n\t\t\t\t\t\t\t\t<div class=\"add-name4\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"add-items3 {{sp.checked3 ? 'active' : '' }}\" ng-repeat=\"sp in spxxList\" ng-click=\"selectSpxxList(sp,$index,$event)\" ng-dblclick=\"selectHpSpxx(sp,$index,$event)\">\r\n\t\t\t\t\t\t\t\t\t\t{{sp.qspmc}}<i class=\"iconfont icon-icon2\" ng-if=\"sp.checked3\"></i>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\t\t\t\t\t\t\t\t\r\n\t\t\t</div>\t\t\t\r\n        </div>\t\r\n        \r\n\t\t<!--<div class=\"add-items\" ng-click=\"selectLabel()\"><i class=\"iconfont icon-icon2\" ng-if=\"item.checked\"></i><i class=\"iconfont icon-cha close\" ng-hide=\"item.checked\" ng-click=\"delLabel(item,$event,$index)\"></i></div>-->\r\n        <div class=\"hpzt\"><field name=\u8d27\u54c1\u72b6\u6001><selector source=\"tagsList\" field=\"name\" id-key=\"id\" ng-model=\"retail.tag\" ng-change=\"getontagList()\"></selector></field>  </div>      \r\n        \r\n        <anniu>\u5bfc\u51fa</anniu>  \r\n        <!--<anniu>\u663e\u793a\u5e93\u5b58\u5747\u4ef7</anniu>-->\r\n    </div>\r\n    \r\n    <grid ng-model=\"retails\" class=noline custom=false editable>  \r\n\t   <div name=\"\u8d27\u54c1\u7c7b\u578b\" field=\"splx\" format=\"cache:'splxList'\"></div>  \r\n\t   <div name=\"\u8d27\u54c1\" field=\"qspmc\"></div> \r\n\t   <div name=\"\u8d27\u54c1\u72b6\u6001\" field=\"spStatus\"></div>  \r\n\t   <div name=\"\u5e93\u5b58\u5747\u4ef7\" field=\"kcjj\"></div>  \r\n\t   <div name=\"\u6700\u8fd1\u8fdb\u4ef7\" field=\"zjjj\"></div>  \r\n\t   <div name=\"\u542f\u7528\u73b0\u4ef7\" field=\"qyxj\" format=\"translate:{'0':'\u542f\u7528','1':'\u672a\u542f\u7528'}\"></div>\r\n\t   <div name=\"\u6700\u4f4e\u73b0\u4ef7\" field=\"xsxj\"></div>  \r\n\t   <div name=\"\u8003\u6838\u6210\u672c\" field=\"a\"><input type=\"hidden\"></div>\r\n\t   <div name=\"\u4fee\u6539\u4eba\" field=\"xgrdm\" format=\"cache:'userlist'\"></div> \r\n\t   <div name=\"\u4fee\u6539\u65e5\u671f\" field=\"xgrq\"></div>  \t   \r\n\t   <div name=\"\u53d8\u4ef7\u8d70\u52bf\" template=\"trend_template\"></div>\r\n\t</grid>       \r\n\r\n</div>\r\n\n"}